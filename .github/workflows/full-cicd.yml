name: Manual CI/CD Demo

on:
  workflow_dispatch:  
jobs:
  full-pipeline:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Start CI/CD Pipeline
      run: |
        echo "STARTING CI/CD DEMONSTRATION"
        echo "================================"
        
    - name: Stage 1 - Testing
      run: |
        echo "STAGE 1: RUNNING TESTS"
        echo "--------------------------"
        mkdir -p data/raw data/processed models
        echo "test" > data/raw/housing.csv
        echo "Test data created"
        
    - name: Stage 2 - Building
      run: |
        echo "STAGE 2: BUILDING DOCKER IMAGE"
        echo "---------------------------------"
        docker build -t demo-ml-service .
        echo "Docker image built"
        
    - name: Stage 3 - Deploying
      run: |
        echo "STAGE 3: DEPLOYING SERVICE"
        echo "-----------------------------"
        docker run -d --name ml-demo -p 8000:8000 demo-ml-service
        sleep 5
        echo "Service deployed"
        
    - name: Stage 4 - Verification
      run: |
        echo "STAGE 4: VERIFICATION"
        echo "------------------------"
        docker ps | grep ml-demo
        echo "Container is running"
        
    - name: Cleanup
      run: |
        echo "CLEANUP"
        echo "----------"
        docker stop ml-demo || true
        docker rm ml-demo || true
        echo "Cleanup completed"
        
    - name: Final Message
      run: |
        echo "========================================"
        echo "CI/CD PIPELINE DEMONSTRATION COMPLETE"
        echo "========================================"
        echo "All stages executed successfully:"
        echo "1. Testing"
        echo "2. Building"
        echo "3. Deploying"
        echo "4. Verification"
        echo "========================================"